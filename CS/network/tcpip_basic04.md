##  IP 어드레스

인터넷 계층에서는 송신지 데이터를 수신지까지 전달해야 하기 때문에 수신지에 대한 고유 식별자가 필요하다.

IP 어드레스는 위치와 상관없이 네트워크 단위로 할당되기 때문에 네트워크 간의 연결 정보를 관리하는 router 가 필요하다.

### 01.  인터넷 계층의 역할

IP 어드레스 정보를 보고 데이터를 전달한다.
(인터넷 계층에서 사용하는 장비에만  IP 어드레스가 할당되며, 네트워크 인터페이스 계층에서 사용되는 네트워크 허브  L2 스위치와 같은 장비에는  할당되지 않는다.)

라우터는 데이터를 목적지까지 전달하기 위해 다음 네트워크 경로의 라우터에 데이터를 위임하는데 이 과정은 연쇄적으로 일어나며 목적지를 찾아나가는 과정을  routing 이라고 한다.

IPv4 의 부족으로  private address 와  public address 를 구분하기도 한다. 보통  private address는 클라이언트 역할을 하는 사무실이나 가정 내 컴퓨터가 주로 사용하며  public  은 반대로 서버 역할을 하는 컴퓨터가 주로 사용한다.

### 02. IPv4 and IPv6

 네트워크에 연결된 컴퓨터를 식별하기 위해 32비트의  IP 어드레스가 사용되며, 사람이 알아보기 쉽게 8비트씩 4단위로 끊고 10진수로 변환해서 표기한다.

*  IPv4 header : ip address, packet 길이 등 정보들이 포함된다.
* packet Time To Live :  패킷이 목적지를 찾지 못할 경우 네트워크 안을 계속 떠돌게 되고 네트워크는 혼잡해진다. 이러한 문제들을 방지하기 위해  IPv4 header 에는 생존기간 정보가 들어있다.
* MTU (Maximum Transmission Unit) : 한 번에 전송할 수 있는 크기를 의미하며 라우터는 패킷을 분할해서 전송하는 기능이 구현되어 있다. 하지만 분할 도중 패킷 일부가 유실되면 복원이 어려워 데이터 송신 전에 통신 경로 전체의  MTU 를 살펴본 후 처움부터  MTU 보다 작은 크기의 패킷을 만들기도 한다. (88p) IPv6는 라우터에서 데이터를 분할하지 않는 방식으로 만들어져 있다.
* IPv6 갈아타기 :  IPv4 와  IPv6 은 서로 호환이 되지 않기 때문에  dual stack 을 통해 하나의 장비가 두 종류의 어드레스를 할당받거나,  tunneling (6이 4를 통과할 때에는 IPv4 안에 6 패킷을 채워서 보내는 방식)을 사용하기도 한다.

### 03. IP 어드레스의 활용

* IP 어드레스는 네트워크(라우터 없이 연결된 네트워크 그룹) + 호스트 (네트워크 그룹 내 컴퓨터나 장비) 부분으로 이루어져있다.
* address class 에 따라서 네트워크 부분의 길이가 다 다르다.
* class A(네트워크 부 8bit) 의 경우는 한개의 네트워크 당 1677만 대의 호스트의 어드레스를 할당할 수 있지만, 실제로 그렇게 많은 호스트를 연결하는 경우는 거의 없다
* subnet mask 이미 정해진 네트워크 부의 길이를 유연하게 늘릴 수 있다.  IP 정보에 추가되는 정보이므로 32 bit 길이만큼의 정보가 더 필요하다
* 네트워크 부로 표현하고 싶은 길이만큼을 bit 1 로 설정하게 되는데 (93p), 한 네트워크 안에서 서브넷 길이를 조절해서 작은 네트워크들을 만들 수 있다. 하지만  subnet 길이를 늘릴수는 있어도 줄일 수는 없다.
* private IP address 는 가정이나 사내에서 자유롭게 사용할 수 있지만  public address 로 변환하고 싶다면  Network Address Trasliation 을 사용해야 한다.
* public address 는 인터넷 레지스트리인 단체에게 인터넷 서비스 제공자들이 신청해 할당 받으며 이 제공자들이 확보한 IP 어드레스를 기업이나 가정이 비렬쓰게 된다.
* loopback address 127.0.0.1 = localhost
* host 부가 모두 0이면 해당 네트워크의 모든 호스트를, 모두 1이면 네트워크 전체를 의미하는 address가 된다.

### 04. routing

* BGP, OSPF, RIP 와 같은  routing protocol 을 통해 누구와 연결되어 있는지 서로 정보를 주고 받는다.
*  Autonomous System 을 통해 몇 개의 네트워크를 하나로 묶어 관리할 수 있고 이를 통해 더 빨리 데이터를 주고 받을 수 있다.

### 05. router and routing protocol

* router :  네트워크 간 패킷을 전달하며 연결하고 있는 각 네트워크에서 사용하는 IP 가 다 필요하며 연결한 만큼 IP 어드레스를 가지게 된다.
* routing table :  목적지 호스트가 속한 네트워크 정보와 그 네트워크에 도달하기 위해 필요한 라우터 정보
* 정적  routing 과  동적  routing :  보통은 자동으로 경로 수집 후 테이블을 설정한다
* 모든 통신 경로를 아는 건 불가능하고  default router 각각 정적으로 설정되어 있어서 거기에 문의하게 된다.
* 동적  routing algorithm
  * 거리 벡터형 :  Routing Information Protocol 이 사용하는 방식으로 거리를 살펴본후 제일 짧은 경로를 선택한다. 경유하는  router의 수 (홉)를 센다. 간단한 LAN 네트워크에 적합하다
  * 링크 상태형 : Open Shortest Path First 에서 사용한다. 통신상태 정보를  map 으로 관리하며 가장 상태가 좋은 네트워크를 선택한다. 경로 불안정성이 높은 네트워크가 주로 사용한다.
  * AS ( 자율 시스템) 내부에서는  OSPF 를 사용하며 규모가 커지면 맵 정보 처리 부하가 커지기 때문에 네트워크 영역을 분할하고 맵을 따로 만든다
  *  AS 외부에서는  Border Gateway Protocol 이 사용되며 경로 도중 경유하는  AS 정보도 포함하여 경로정보를 만든다 **

### 06. 네트워크 오류를 통보하는 ICMP
* 데이터가 전달되지 못했을 떄 송신측으로  ICMP 메세지가 발송된다.  type 을 바탕으로 처리를 한다.
* TTL이 경과해 패킷이 소멸될 경우 송신 측으로 11 ICMP 메세지를 보낸다.

### 07. address  변환
* private 주소는  public 주소와 호환되지 않기 때문에 이를 변환하기 위한  NAT 기술이 사용된다.  NAT 는 이 뿐만 아니라  IPv4 와  IPv6 변환에 사용되기도 한다.
*  router는 송신지의  private 주소를  public 으로 변환하고 그 정보를 가지고 있으며 다른 두개의 컴퓨터가 같은 포트를 사용할 경우에 하나의 포트 정보도 바꿔서 그 정보를 저장한다. (NAPT :  Network Address Port Translation)
* 사용자의 요청없을 때에 송신을 받아야하는 상황일 때는 계속해서 수신을 원하는 내부 컴퓨터에서 요청을 주기적으로 보내는 방법을 사용하기도 하며, LAN 안의 서버를 공개해야할 경우에는  port forwarding 을 이용한다. (109p)

### 08. 도메인명
* IP 주소는 이해하기 어렵기 때문에 도메인명을 주로 사용한다.
*  IP address에 해당하는 정보가 알고 싶을 때  DNS 서버에 질의를 한다
* 도메인은 논리적으로 계층적 구조를 띄고 있다.  kr -> co -> sample
* DNS를 관리하는 서버도 이에 따라 계층적으로 구성되어 있다.
* DNS 서버에 질의할 경우   도메인 명을 관리하는 content 서버는 하위 서버의  IP를 응답하며 응답을 받은  caching server는 원하는 IP address 를 얻을 때까지 계층적으로 질의를 한 후 회신을 한다.
* 가끔 OS에서 hosts 파일을 볼 수 있는데  DNS 서버 사용하지 않고  test로 사용할 경우 주로 쓴다.
*  DNS 도메인을 등록하려면 등록 대행 업체를 통해 신청하며  DNS서버에 등록되는 정보를  resource record 라고 부르며 레코드가 등록된 파일은  zone file 이라고 한다.

### 09. IP어드레스를 자동으로 할당하는 DHCP

* Dynamic Host Configuration Protocol : 자동으로  IP address 할당. 가정용  router는 대부분  DHCP 서버 기능을 가지고 있어 private IP 를 할당한다. 공공장소의 무료 wifi도 이 방식을 사용한다.
* 새로운 host가 연결되면, DHCP는 인지를 못하기 때문에 host가 먼저 모든 네트워크에 연결된 host에  DHCP 발견 메세지를 보내고 DHCP 서버는 이를 인식하여 새 IP를 발급한다. 이 때  DHCP는 어떤 host인지 판별하지 못하므로 모두에게  IP 주소를 보내고 이미 할당된 host는 그 패킷을 버리고, 할당되지 않은 host는 이를 할당받게 된다.
